## 一个很坑的点

OpenWRT默认线程的栈大小是64KB，我这个程序开到了有差不多2MB。因此要手动设置一下。下面是我Debug的复盘，有兴趣可以看一下。

这个点有多坑呢，首先我在交叉编译后放到OpenWRT运行，结果刚运行就直接弹出`SegmentionError`。当时第一反应是交叉编译环境出错，检查了一通环境变量，CMake脚本。

之后转变思路，用同样的交叉编译流程编译了一个`HelloWorld`程序。结果是能成功在OpenWRT上运行，**初步排查掉交叉编译环境问题**。

在HelloWorld的基础上，一步一步加上该项目的函数模块，最后排查出来是调用pthread会出问题。

思路是对的。通过`ldd openwrt-sniffer`后，发现是没有相关的 `pthread.so`。怀疑是OpenWRT操作系统上pthread的依赖有问题，开始检查`lib`目录，发现果然没有pthread。

但查询资料后发现是预期行为，OpenWRT将 pthread相关库移植到了一个统一的 .so文件里面。于是陷入死胡同。

最后是AI无意间提到OpenWRT的线程栈默认大小只有64KB，才解决了出来。如果没有AI可能花一周都弄不出来，下一步可能都要上gdb了哈哈哈。

*chat-gpt-o3, qwq-32B我都问烂了也没看出来哈哈哈，看来AI还是替代不了人类的。*
## 感想
这个实验虽然是计网安排的，但交叉编译等环境配置反而是更大的难点。解决问题的过程也十分有乐趣。

我遇到的几个比较有意思的点是：
- 在NAT网络模式下，在OpenWRT虚拟中使用http_proxy配置宿主机代理。
- 给OpenWRT配置了一遍`sshd`。（一开始是连不上的，需要开放监听端口才能从宿主机连进去）

